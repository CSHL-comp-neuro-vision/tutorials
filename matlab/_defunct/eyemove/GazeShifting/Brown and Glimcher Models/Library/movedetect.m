function y=movedetect(x,y,vel,time);% Returns a count of completed movements y, and a pulse whenever movement% offset is detected.%% Displays a 2-d array of movement parameters, indexed by the sequential% movement number, starting with movement #1.% parameters:%	1 amplitude%	2 duration%	3 peak velocity%	4 onset time%	5 offset time%	6 onsetx%	7 onsety%	8 offsetx%	9 offsety%	10 pvel time% These are variables which have to be remembered between time steps:global mvmntcount;global startflag;global mvmnt;global onx;global ony;global ontime;global pvel;global pvelt;global endflag; % endflag is a signal to endflagreader.mendflag=-1;pulse=0;if (vel>pvel)  pvel=vel;  pvelt=time;end;if (time==0) % reset these variables at the begginning of each simulation!  startflag=0;  mvmntcount=0;  pvel=0;  pvelt=0;  mvmnt=[0 0 0 0 0 0 0 0 0 0];elseif (vel>30 & (startflag==0))  startflag=1;  ontime=time;  onx=x;  ony=y;elseif (vel<30 & startflag)  endflag=1;  disp(endflag);  mvmntcount=mvmntcount+1;  amp=sqrt((x-onx)^2 + (y-ony)^2);  dur=time-ontime;  mvmnt(mvmntcount,1:10)=[amp,dur,pvel,ontime,time,onx,ony,x,y,pvelt];  disp('movement parameters:');  params=sprintf('%.2f, %.3f, %.2f, %.3f, %.3f, %.2f, %.2f, %.2f, %.2f %.3f',mvmnt(mvmntcount,:));  disp(params);  startflag=0;  pvel=0; % pvel has to be reset before each movement!end;y=[mvmntcount,endflag];