global mdata memdata endflagclear specload spec.xyz;endflag=-1;% eval(['load ' filename])%increment the figure counterif ~exist('FN'), FN=0; end;FN=FN+1;[NR(FN),NC(FN)]=size(spec);% background colorbgc=[0.9 0.9 0.9];top=20*NR(FN)+100;% make a new figurefigure;set(gcf,'Visible','off');set(gcf,'Position',[400 50 210 top]);set(gcf,'Resize','off');set(gcf,'Color',bgc);set(gcf,'UserData',FN);onsetlabel(FN)=uicontrol(gcf,...  'Style','text',...  'BackgroundColor',bgc,...  'ForegroundColor','black',...  'String','Onset',...  'Position',[30,top-20,30,17]);xdisplabel(FN)=uicontrol(gcf,...  'Style','text',...  'BackgroundColor',bgc,...  'ForegroundColor','black',...  'String','X-disp',...  'Position',[80,top-20,35,17]);ydisplabel(FN)=uicontrol(gcf,...  'Style','text',...  'BackgroundColor',bgc,...  'ForegroundColor','black',...  'String','Y-disp',...  'Position',[130,top-20,35,17]);dobutton(FN)=uicontrol(gcf,...  'Style','push',...  'String','Make Input Matrices',...  'Position',[20 top-NR(FN)*20-94 175 30],...  'Callback',[...    'mdata=0;',...	'tempfn=get(gcf,''UserData'');',...	'j=1;',...    'for i=1:NR(tempfn);',...	  'if get(onbutton(tempfn,i),''Value'')==1,',...	    'mdata(j,1:3)=['...	       'str2num(get(onset(tempfn,i),''string'')),'...		   'str2num(get(hor(tempfn,i),''string'')),'...		   'str2num(get(vert(tempfn,i),''string''))];'...	    'j=j+1;',...	  'end;',...	'end;',...	'memdata=mdata;',...	'fastmakeinput;']);saveedit(FN)=uicontrol(gcf,...    'Style','edit',...    'String','spec.xyz',...    'Position',[75,top-NR(FN)*20-62,115,17]);loadedit(FN)=uicontrol(gcf,...    'Style','edit',...    'String','spec.xyz',...    'Position',[75,top-NR(FN)*20-42,115,17]);savebutton(FN)=uicontrol(gcf,...  'Style','push',...  'String','Save',...  'Position',[20 top-NR(FN)*20-62 50 17],...  'Callback',[...    'ddata=0;',...	'tempfn=get(gcf,''UserData'');',...    'for i=1:NR(tempfn);',...	    'ddata(i,1:4)=['...	       'str2num(get(onset(tempfn,i),''String'')),'...		   'str2num(get(hor(tempfn,i),''String'')),'...		   'str2num(get(vert(tempfn,i),''String'')),'...		   'get(onbutton(tempfn,i),''Value'')];'...	'end;'...	'eval([''save '',get(saveedit(FN),''String''),'' ddata -ascii'']);']);loadbutton(FN)=uicontrol(gcf,...  'Style','push',...  'String','Load',...  'Position',[20 top-NR(FN)*20-42 50 17],...  'Callback',[...    'clear spec;',...    'loadfile=get(loadedit(FN),''String'');',...    'eval([''load '',loadfile]);',...	'eval([''spec='',loadfile(1:length(loadfile)-4),'';'']);',...	'tempfn=get(gcf,''UserData'');',...	    '[newnrow(tempfn),dud]=size(spec);',...    'for i=1:newnrow(tempfn);',...	  'set(onset(tempfn,i),''String'',num2str(spec(i,1))),'...	  'set(hor(tempfn,i),''String'',num2str(spec(i,2))),'...	  'set(vert(tempfn,i),''String'',num2str(spec(i,3))),'...	  'set(onbutton(tempfn,i),''Value'',spec(i,4)),'...	'end;'...	]);for i=1:NR(FN)  olabel(FN,i)=uicontrol(gcf,...    'Style','text',...    'BackgroundColor',bgc,...    'ForegroundColor','black',...    'String',num2str(i),...    'Position',[5,top-20-i*20,25,17]);  onbutton(FN,i)=uicontrol(gcf,...    'Style','radio',...    'Position',[180,top-20-i*20,40,17],...	'Value',spec(i,4),...    'BackgroundColor',bgc);  onset(FN,i)=uicontrol(gcf,...    'Style','edit',...    'String',num2str(spec(i,1)),...    'Position',[30,top-20-i*20,40,17],...	'UserData',onbutton(FN,i),...    'CallBack',[...	  'contr=get(gcf,''CurrentObject'');',...      'entry=str2num(get(contr,''String''));',...	  'if entry<0,',...	    'disp(''ERROR - value must be positive '');',...      'elseif entry>0,',...	    'set(get(contr,''UserData''),''Value'',1);',...      'end;']);  hor(FN,i)=uicontrol(gcf,...    'Style','edit',...    'String',num2str(spec(i,2)),...    'Position',[80,top-20-i*20,40,17],...	'UserData',onbutton(FN,i),...    'CallBack',[...	  'contr=get(gcf,''CurrentObject'');',...      'entry=str2num(get(contr,''String''));',...	  'if entry<0,',...	    'disp(''ERROR - value must be positive '');',...      'elseif entry>0,',...	    'set(get(contr,''UserData''),''Value'',1);',...      'end;']);  vert(FN,i)=uicontrol(gcf,...    'Style','edit',...    'String',num2str(spec(i,3)),...    'Position',[130,top-20-i*20,40,17],...	'UserData',onbutton(FN,i),...    'CallBack',[...	  'contr=get(gcf,''CurrentObject'');',...      'entry=str2num(get(contr,''String''));',...	  'if entry<0,',...	    'disp(''ERROR - value must be positive '');',...      'elseif entry>0,',...	    'set(get(contr,''UserData''),''Value'',1);',...      'end;']);set(gcf,'Visible','on');end