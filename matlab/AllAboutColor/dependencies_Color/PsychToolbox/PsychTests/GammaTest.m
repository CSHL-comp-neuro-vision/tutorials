function GammaTest% GammaTest is a quick check of setting and getting Gamma. I am particulary interested% in how this works on the Radius Thunder card, which has 10-bit dacs. %% Denis Pelli 18 July 1998% 7/20/98 dgp enhanced, based on feedback from Steve Engel, running it on his Radius Thunder.% 7/21/98 dgp improved error checking.% 7/25/98 dgp add conclusion% 8/26/98 dgp apply logical() to ok for logical indexing.% 5/20/99 dgp Test most cards only at nominal dac size.ss=SCREEN('Screens');for s=ss	DescribeScreen(s); 	[card,driver,driverVersion,slot]=SCREEN(s,'VideoCard');	[oldGammaTable,oldDacSize,gammaError]=SCREEN(s,'Gamma');	if strcmp(driver,'.Display_Marin')		fprintf('This is the Radius Thunder card.\n');		thunder=1;		dacSizes=[8 9 10];	else		thunder=0;		dacSizes=[oldDacSize];	end	fprintf('                                       ');	fprintf('Getting %2d bits [%x:%4x] %dx%d. \n',oldDacSize,oldGammaTable(1,1),oldGammaTable(end,1),size(oldGammaTable));	SCREEN('CloseAll');	ok=ones(size(dacSizes));	gammaLength=size(oldGammaTable,1);	for i=1:length(dacSizes)		dacSize=dacSizes(i);		if dacSize~=8			gammaLengths=2.^[8 dacSize];		else			gammaLengths=2^8;		end		for gammaLength=gammaLengths			gammaTable=((2^dacSize-1)/(gammaLength-1))*[0:(gammaLength-1)]';			fprintf('Setting to %2d bits [0:%4x] %3dx1:     ',dacSize,max(gammaTable),gammaLength);			[oldGammaTable,oldDacSize,gammaError]=SCREEN(s,'Gamma',gammaTable,dacSize);			clear oldGammaTable oldDacSize			[oldGammaTable,oldDacSize]=SCREEN(s,'Gamma');			if gammaError.set				fprintf('Error %d\n',gammaError.set);				ok(i)=0;			else				fprintf('Getting %2d bits [%x:%4x] %dx%d. \n',oldDacSize,oldGammaTable(1,1),oldGammaTable(end,1),size(oldGammaTable));				ok(i)=all(gammaTable==oldGammaTable);			end		end		fprintf('Open & close window:                   ');		w=SCREEN(s,'OpenWindow');		[oldGammaTable,oldDacSize,gammaError]=SCREEN(s,'Gamma');		SCREEN(w,'Close');		fprintf('Getting %2d bits [%x:%4x] %dx%d. \n',oldDacSize,oldGammaTable(1,1),oldGammaTable(end,1),size(oldGammaTable));	end	if sum(ok)==1		fprintf('CONCLUSION: true dacSize is%3d.\n',dacSizes(logical(ok)));	else		fprintf('CONCLUSION: true dacSize is one of [');fprintf('%3d',dacSizes);fprintf('].\n');	endendDescribeScreen(-1);