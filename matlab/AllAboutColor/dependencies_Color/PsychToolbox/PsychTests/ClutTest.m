function ClutTest% ClutTest.m%% Read-write test of the CLUT associated with each screen. % % This test of your CLUT hardware is independent of the pixel size. As you% may know, every video card generates its output voltage by first% transforming the pixel (which may be 1, 2, 4, 8, 16, or 24 bits) through% the CLUT, which drives three digital to analog converters (DACs). Most% video cards have 8-bit DACs, but a few have 9- or 10-bit DACs. You can% use the Monitors control panel to change the pixel size, but the number% of bits in the DACs is fixed. There are at most 256 CLUT entries. On the% video card, each CLUT entry is a triplet of the same number of bits as% the three DACs accept, i.e. three 8, 9, or 10-bit values.% % For each CLUT entry, the device's video driver accepts and returns an% RGB color triplet of 16-bit numbers, but most drivers and CLUTs use only% the top 8 of those bits. Video cards that have more-than-8 bit DACs% store more-than-8 bits in each CLUT entry. The drivers for some of these% cards allow you to specify all these bits directly using cscSetEntries% (used by SetClut) and read them using cscGetEntries (used by GetClut).% Alas, most drivers for cards with more-than-8 bit DACs stubbornly use% only the top 8 bits of the values passed in those calls, and force you% to use the gamma table translation (see "SCREEN Gamma?") to specify the% full more-than-8 bits that are stored in the CLUT. If there is% sufficient interest, I am willing to enhance SetClut and GetClut to make% them smart enough to do all this for us, behind the scenes. Let me know.% denis@psych.nyu.edu% % p.s. I don't have a video card with more-than-8 bit DACs to test this program% on. If you do, could you let me know whether it works? denis@psych.nyu.edu% dgp 4/4/96 Wrote it in response to a bug report from Sacha Nelson, nelson@BINAH.CC.BRANDEIS.EDU.% dgp 8/2/97 Enhanced to better explain the more-than-8 bit case.% dhb 8/14/97 Condition the bitshift call on version so it will also run under MATLAB 4.%			 Don't use isequal since it won't work under MATLAB 4.%	dgp	8/15/97 prettier way to get numerical version% 7/9/98   dgp  Cope when GetClut is not available.% 7/13/98  dgp  Change pixelSize to 8 when GetClut not available.% 7/17/98		dgp Remove MATLAB 4 stuff. We now require MATLAB 5.fprintf('ClutTest does a write-then-read test of the Color Lookup Table (CLUT) of the\n');fprintf('video device associated with each of your screens. This tests your CLUT \n');fprintf('hardware, and is usually independent of the current pixel size.\n');moreThan8=0;for screenNumber=SCREEN('Screens');	DescribeScreen(screenNumber);	clutDacSize=SCREEN(screenNumber,'Preference','ClutDacSize');	w=SCREEN(screenNumber,'OpenWindow',0,[0 0 100 100]);	SCREEN('MATLABToFront',0);	test=1;	clut2=SCREEN(screenNumber,'GetClut');	if isempty(clut2)		fprintf('GetClut is not supported by this video driver at pixelSize %d. Changing to 8.\n',SCREEN(screenNumber,'PixelSize'));		SCREEN(screenNumber,'PixelSize',8);	end	if clutDacSize==8		bitsList=8;	else		bitsList=[8 clutDacSize];		moreThan8=1;	end	for bits=bitsList		for startEntry=[0 127]			fprintf('%d. Write top %d bits to CLUT and read it back. startEntry=%d.\n',test,bits,startEntry);			clut1=257*[0:255;0:255;0:255]';			clut1=bitshift(clut1,bits-16);			SCREEN(screenNumber,'SetClut',clut1([startEntry+1:256 1:startEntry],:),startEntry,bits);			clut2=SCREEN(screenNumber,'GetClut',bits);			if isempty(clut2)				fprintf('GetClut is not supported by this video driver at pixelSize %d. Skipping to next test.\n',SCREEN(screenNumber,'PixelSize'));				break;			end			if (max(max(abs(clut1-clut2))) == 0)				fprintf('Success!\n');			else				fprintf('Failed! Values read differed from what was written.\n');				if bits==8					for row=[1 2 127 256]						fprintf('%3d entry. SetClut:[%5d %5d %5d] vs. GetClut:[%5d %5d %5d]\n',row-1,clut1(row,:),clut2(row,:))					end				else					fprintf('It appears that you''ll have to use SCREEN(''Gamma'') to set the more-than-8 bits in this device''s CLUT entries.\n');				end			end			test=test+1;		end	end	SCREEN('CloseAll');endDescribeScreen(-1);if moreThan8	fprintf('p.s. I don''t have a video card with more-than-8 bit DACs to test this program on.\n');	fprintf('Apparently you do. Did ClutTest work? Please let me know. denis@psych.nyu.edu\n');end