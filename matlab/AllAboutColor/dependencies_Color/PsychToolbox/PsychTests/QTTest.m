function QTTest% Test QT.mex. Create and display a QuickTime movie.% % Example: Specifying only some frames within a media's frame set to% be included in a track% % This example will create either of two different movies, depending% on the setting of "fullLength". If fullLength is true, then we% create an 8-frame moving-bar movie. Otherwise we create a movie with% 3 frames using the 3rd to the 6th frame of the same movie data used% in the first.  The only change is in the parameters supplied to the% function QT 'VideoTrackSamplesSet'.% % Denis Pelli, 11/99% dgp 11/7/99 Wrote it, based on Beau Watson's Mathematica qtWrite tutorial.% dgp 11/9/99 Put movie in root directory.% dgp 11/12/99 Put movie on desktop.clear qt	% use latest QT.mexfullLength=1;% windowwhichScreen=0;window=SCREEN(whichScreen,'OpenWindow');white=GrayIndex(window,1);black=GrayIndex(window,0);gray=GrayIndex(window,0.5);if round(gray)==white	gray=black;endinc=white-gray;SCREEN(window,'FillRect',gray);% gratingframes=90;[x,y]=meshgrid(-50:50,-50:50);angle=17*pi/180; % 17 deg orientation; change it to whatever you want.f=0.03*2*pi;rate=FrameRate(window);hz=2;a=cos(angle)*f;b=sin(angle)*f;driftingGabor=uint8(zeros(size(x)));driftingGabor(:,:,frames)=driftingGabor;for i=1:frames 	m=exp(-((x/25).^2)-((y/25).^2)).*sin(a*x+b*y+2*pi*(i/rate)*hz);	t=4*(i-frames/2)/frames;	driftingGabor(:,:,i)=gray+inc*m*exp(-t^2);	SCREEN(window,'PutImage',driftingGabor(:,:,i));endSCREEN(window,'Close');% Save the QuickTime movie file in the user's desktop.s=matlabroot;n=findstr(filesep,s);root=s(1:n(1));cd(fullfile(root,'Desktop Folder',''));filename='DriftingGrating.mov';% Make the movie, and save it to disk as a QuickTime movie file.bits=SCREEN(whichScreen,'PixelSize');rows=size(driftingGabor,1);cols=size(driftingGabor,2);trackTimescale=600;frameDuration=round(trackTimescale/FrameRate(0)); % frameDuration=round(trackTimescale/frames); preload=1;window=SCREEN(whichScreen,'OpenWindow');movie=QT('MovieCreate',filename,window);QT('VideoTrackCreate',movie,rows,cols,trackTimescale,preload);QT('VideoMediaCreate',movie);QT('VideoMediaSamplesAdd',movie,driftingGabor,bits,frameDuration);QT('VideoMediaSave',movie);if fullLength	trackStartTime=[];	% default is 0	startInMedia=[];	% default is 0	durationInMedia=[];	% default is full lengthelse	trackStartTime=0;	startInMedia=frameDuration*2; 		% third frame	durationInMedia=frameDuration*3;	% use 3 framesendQT('VideoTrackSamplesSet',movie,trackStartTime,startInMedia,durationInMedia);QT('VideoTrackSave',movie);QT('MovieUserDataAdd',movie,'A movie demo.','©inf');QT('MovieSave',movie);SCREEN(window,'Close');fprintf('Your new %d-bit QuickTime movie "%s" is on your desktop.\n',bits,filename);% show the moviemovie=QT('GetFromFile',filename);hz=QT('Rate',movie);fprintf('%.1f Hz rate\n',hz);% QT('Rate',movie,'screenRate');% hz=QT('Rate',movie);% fprintf('%.1f Hz screenRate\n',hz);if 0	%sound=QT('Sound',array)	sound=QT('GetFromFile','droplet');	QT('Add',movie,sound);	QT('Dispose',sound);end% error=QT('SaveToFile',movie)QT('LoadIntoRam',movie);window=SCREEN(whichScreen,'OpenWindow');QT('Window',movie,window);% QT('Scale',movie,1);% QT('Rate',movie,FrameRate(whichScreen));% lut=ClutDefault(window);% QT('SetClut',window,lut);for i=1:5;	QT('Show',movie);end% QT('Fill',movie,255);% WaitSecs(0.5);QT('Dispose',movie);SCREEN(window,'Close');