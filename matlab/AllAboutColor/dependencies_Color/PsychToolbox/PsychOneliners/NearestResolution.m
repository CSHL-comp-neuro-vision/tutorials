function res=NearestResolution(screenNumber,width,height,hz,pixelSize)% res=NearestResolution(screenNumber,[width,height,hz,pixelSize])%% Finds the available screen resolution most similar (in log cartesian space) to that% requested. Any argument that is [] or NaN will be ignored in assessing similarity.% If you specify pixelSize then the returned res will specify pixelSize. Typically% you'll use the returned "res" to set your screen's resolution:% SCREEN(screenNumber,'Resolution',res)% % Also see SetResolution, ResolutionTest, and SCREEN Resolution and Resolutions.%% Denis Pelli% HISTORY:% 1/28/00 dgp Wrote it.if nargin<2 | nargin>5	error('USAGE: res=NearestResolution(screenNumber,[width,height,hz,pixelSize])');endif nargin<5	pixelSize=[];endif nargin<4	hz=[];endif nargin<3	height=[];endif screenNumber<0 | screenNumber>SCREEN('Screens')	error(sprintf('Invalid screenNumber %d.',screenNumber));endres=SCREEN(screenNumber,'Resolutions'); % get a list of available resolutionswish.width=width;	wish.height=height;wish.hz=hz;wish.pixelSize=pixelSize;for i=1:length(res)	d(i)=distance(wish,res(i));end[x,i]=min(d);res=res(i);if isfinite(wish.pixelSize)	[dp,ip]=min(log10(wish.pixelSize ./ res.pixelSizes) .^ 2);	res.pixelSize=res.pixelSizes(ip);endreturnfunction d=distance(a,b)% "a" may omit values, for which you "don't care".% "a" has "pixelSize" field, but "b" has "pixelSizes" field.d=0;if isfinite(a.width)	d=d+log10(a.width/b.width)^2;endif isfinite(a.height)	d=d+log10(a.height/b.height)^2;endif isfinite(a.hz)	d=d+log10(a.hz/b.hz)^2;endif isfinite(a.pixelSize)	d=d+min(log10(a.pixelSize ./ b.pixelSizes) .^ 2);endreturn